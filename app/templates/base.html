<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCP Inventory</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <!-- Optional for icons, using text fallback if not loading -->
    <!-- Using local simple icons or just text if fontawesome setup is complex without key. I'll use simple ASCII or text/emoji fallback if needed, or link a CDN that works -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <a href="/dashboard" style="color:inherit; text-decoration:none;"><i class="fas fa-cubes"></i> OCP
                    Inventory</a>
            </div>


            <ul class="nav-links" id="cluster-list">
                <!-- User Profile Section -->
                {% if user %}
                <li
                    style="padding: 1rem; border-bottom: 1px solid var(--border-color); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.8rem;">
                    <div
                        style="width: 32px; height: 32px; background: var(--accent-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white;">
                        {{ user.username[0]|upper }}
                    </div>
                    <div style="flex: 1; overflow: hidden;">
                        <div
                            style="font-weight: 600; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            {{ user.username }}</div>
                        <div style="font-size: 0.7rem; opacity: 0.6; display: flex; align-items: center; gap: 0.3rem;">
                            <i class="fas fa-circle" style="font-size: 0.4rem; color: var(--success-color);"></i>
                            {% if user.is_admin %}Administrator{% else %}Regular User{% endif %}
                        </div>
                    </div>
                    <a href="/logout" title="Logout"
                        style="color: var(--text-secondary); opacity: 0.6; transition: 0.2s;"
                        onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.6">
                        <i class="fas fa-power-off"></i>
                    </a>
                </li>
                {% endif %}

                <!-- Administration Group -->
                {% if user.is_admin %}
                <li
                    style="padding: 0.5rem 1rem; font-size: 0.75rem; font-weight: bold; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-top: 0.5rem; margin-bottom:0.2rem;">
                    Administration
                </li>
                <li class="nav-item">
                    <a href="/admin" class="nav-link {% if page == 'admin' %}active{% endif %}">
                        <i class="fas fa-server"></i> Clusters
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/audit" class="nav-link {% if page == 'audit_rules' %}active{% endif %}">
                        <i class="fas fa-clipboard-list"></i> Audit Rules
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/compliance" class="nav-link {% if page == 'compliance' %}active{% endif %}">
                        <i class="fas fa-check-circle"></i> Compliance
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/settings"
                        class="nav-link {% if page == 'settings' or page == 'settings_users' or page == 'settings_ldap' %}active{% endif %}"
                        onclick="event.preventDefault(); document.getElementById('settings-submenu').style.display = document.getElementById('settings-submenu').style.display === 'block' ? 'none' : 'block';">
                        <i class="fas fa-cog"></i> App Config <i class="fas fa-chevron-down"
                            style="font-size:0.7rem; margin-left:auto; opacity:0.5;"></i>
                    </a>
                    <div id="settings-submenu"
                        style="padding-left: 2rem; display: {% if page == 'settings_users' or page == 'settings_ldap' %}block{% else %}none{% endif %};">
                        <a href="/settings/users" class="sub-link {% if page == 'settings_users' %}active{% endif %}"
                            style="padding: 0.4rem 0.5rem; font-size: 0.85rem; display: block; color: var(--text-secondary); text-decoration: none;">
                            <i class="fas fa-users" style="width: 1.2rem;"></i> Users
                        </a>
                        <a href="/settings/ldap" class="sub-link {% if page == 'settings_ldap' %}active{% endif %}"
                            style="padding: 0.4rem 0.5rem; font-size: 0.85rem; display: block; color: var(--text-secondary); text-decoration: none;">
                            <i class="fas fa-network-wired" style="width: 1.2rem;"></i> LDAP Settings
                        </a>
                    </div>
                </li>
                {% endif %}

                <!-- Search and Filters -->

                <!-- Search and Filters -->
                <li style="padding: 0.5rem 1rem;">
                    <input type="text" id="cluster-search" placeholder="Search clusters..." class="form-input"
                        style="font-size:0.85rem; padding:0.4rem; margin-bottom: 0.5rem; width:100%; box-sizing:border-box;"
                        onkeyup="filterClusters()">

                    <div style="display: flex; gap: 0.3rem; flex-wrap: wrap;">
                        <button class="filter-btn active" onclick="toggleFilter(this, 'DEV')" data-filter="DEV"
                            style="flex:1; font-size:0.75rem; padding:0.3rem;">DEV</button>
                        <button class="filter-btn active" onclick="toggleFilter(this, 'UAT')" data-filter="UAT"
                            style="flex:1; font-size:0.75rem; padding:0.3rem;">UAT</button>
                        <button class="filter-btn active" onclick="toggleFilter(this, 'PROD')" data-filter="PROD"
                            style="flex:1; font-size:0.75rem; padding:0.3rem;">PROD</button>
                    </div>
                </li>

                {% if clusters_by_dc %}
                {% for dc, dc_clusters in clusters_by_dc.items() %}
                <li
                    style="padding: 0.5rem 1rem; font-size: 0.75rem; font-weight: bold; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-top: 1rem;">
                    {{ dc }}
                </li>

                {% for cluster in dc_clusters %}
                <li class="nav-item cluster-item" data-name="{{ cluster.name|lower }}"
                    data-dc="{{ cluster.datacenter }}" data-env="{{ cluster.environment }}">
                    <a href="#" class="nav-link cluster-link" data-cluster-id="{{ cluster.id }}"
                        onclick="toggleClusterMenu({{ cluster.id }})">
                        <i class="fas fa-server"></i> {{ cluster.name }}
                        <span style="font-size:0.7rem; opacity:0.7; margin-left: auto;">{{ cluster.environment }}</span>
                    </a>
                    <div class="resource-submenu" id="submenu-{{ cluster.id }}">
                        <a href="#" class="sub-link" onclick="loadResource({{ cluster.id }}, 'nodes')">Nodes</a>
                        <a href="#" class="sub-link" onclick="loadResource({{ cluster.id }}, 'machines')">Machines</a>
                        <a href="#" class="sub-link"
                            onclick="loadResource({{ cluster.id }}, 'machinesets')">MachineSets</a>
                        <a href="#" class="sub-link" onclick="loadResource({{ cluster.id }}, 'projects')">Projects</a>
                        <a href="#" class="sub-link"
                            onclick="loadResource({{ cluster.id }}, 'machineautoscalers')">Autoscalers</a>
                    </div>
                </li>
                {% endfor %}

                {% endfor %}
                {% else %}
                <!-- Legacy fallback if viewed directly without dict, though router handles it -->
                {% for cluster in clusters %}
                <li class="nav-item cluster-item" data-name="{{ cluster.name|lower }}"
                    data-dc="{{ cluster.datacenter }}" data-env="{{ cluster.environment }}">
                    <a href="#" class="nav-link cluster-link" data-cluster-id="{{ cluster.id }}"
                        onclick="toggleClusterMenu({{ cluster.id }})">
                        <i class="fas fa-server"></i> {{ cluster.name }}
                        <span style="font-size:0.7rem; opacity:0.7; margin-left: auto;">{{ cluster.environment }}</span>
                    </a>
                    <div class="resource-submenu" id="submenu-{{ cluster.id }}">
                        <a href="#" class="sub-link" onclick="loadResource({{ cluster.id }}, 'nodes')">Nodes</a>
                        <a href="#" class="sub-link" onclick="loadResource({{ cluster.id }}, 'machines')">Machines</a>
                        <a href="#" class="sub-link"
                            onclick="loadResource({{ cluster.id }}, 'machinesets')">MachineSets</a>
                        <a href="#" class="sub-link" onclick="loadResource({{ cluster.id }}, 'projects')">Projects</a>
                        <a href="#" class="sub-link"
                            onclick="loadResource({{ cluster.id }}, 'machineautoscalers')">Autoscalers</a>
                    </div>
                </li>
                {% endfor %}
                {% endif %}
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            {% block content %}{% endblock %}
        </main>
    </div>

    <script src="/static/app.js"></script>
</body>

</html>